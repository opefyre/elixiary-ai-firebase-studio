/* Mobile PWA Fixes - iOS Safe Area and Viewport Handling */

/* Global safe area CSS variables */
:root {
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
}

/* CRITICAL: Apply safe area padding to body for iOS PWA */
/* Only apply on mobile devices to avoid desktop issues */
@media screen and (max-width: 768px) {
  body {
    /* Only apply side and bottom padding, top is handled by navbar */
    padding-right: var(--safe-right);
    padding-bottom: var(--safe-bottom);
    padding-left: var(--safe-left);
  }
}

/* Paint behind the status bar on iOS - Critical fix from web.dev article */
body::before {
  content: "";
  position: fixed;
  top: 0; 
  left: 0; 
  right: 0;
  height: var(--safe-top);
  background: hsl(var(--background));
  pointer-events: none;
  z-index: 49; /* Just below navbar */
}

/* Fix for iOS PWA navbar positioning - Based on web.dev article */
@media screen and (max-width: 768px) {
  /* Navbar with proper safe area handling */
  .mobile-navbar-fix {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 50;
    /* Add safe area padding to navbar content */
    padding-top: var(--safe-top);
    margin: 0;
  }
  
  /* Add padding to body to account for fixed navbar */
  .mobile-body-padding {
    padding-top: calc(4rem + var(--safe-top));
  }
  
  /* Fix for content appearing above navbar when scrolling */
  .mobile-content-container {
    position: relative;
    z-index: 1;
  }
}

/* AGGRESSIVE iOS PWA FIX - Force status bar handling */
@supports (-webkit-touch-callout: none) {
  /* iOS PWA specific - when running as standalone app */
  .ios-pwa .mobile-navbar-fix {
    /* Force navbar to extend behind status bar */
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    margin: 0 !important;
    padding-top: 0 !important;
    /* Make sure navbar background covers status bar area */
    background: hsl(var(--background) / 0.8);
    backdrop-filter: blur(12px);
  }
  
  .ios-pwa .mobile-navbar-fix .container {
    /* Add safe area padding to content inside navbar */
    padding-top: max(env(safe-area-inset-top, 44px), 44px) !important;
    /* 44px is minimum safe area for iPhone status bar */
  }
  
  .ios-pwa .mobile-body-padding {
    /* Adjust body padding for PWA mode */
    padding-top: calc(4rem + max(env(safe-area-inset-top, 44px), 44px)) !important;
  }
  
  /* Force status bar area to be painted */
  .ios-pwa body::before {
    height: max(env(safe-area-inset-top, 44px), 44px) !important;
    background: hsl(var(--background)) !important;
    z-index: 48 !important;
  }
}

/* iOS PWA specific fixes */
@supports (-webkit-touch-callout: none) {
  /* iOS Safari specific styles */
  .ios-pwa-fix {
    /* Prevent content from appearing behind status bar */
    padding-top: var(--safe-top);
  }
  
  /* Fix for iOS viewport height issues */
  .ios-viewport-fix {
    min-height: 100vh;
    min-height: -webkit-fill-available;
  }
  
  /* Fix for iOS scroll bounce */
  .ios-scroll-fix {
    overscroll-behavior: none;
    -webkit-overflow-scrolling: touch;
  }
}

/* Android PWA fixes */
@media screen and (max-width: 768px) and (min-resolution: 2dppx) {
  .android-pwa-fix {
    /* Android specific PWA fixes */
    -webkit-tap-highlight-color: transparent;
  }
}

/* General mobile PWA improvements */
@media screen and (max-width: 768px) {
  /* Prevent zoom on input focus */
  input, textarea, select {
    font-size: 16px;
  }
  
  /* Improve touch targets */
  button, a, [role="button"] {
    min-height: 44px;
    min-width: 44px;
  }
  
  /* Fix for mobile viewport units */
  .mobile-vh-fix {
    height: 100vh;
    height: calc(var(--vh, 1vh) * 100);
  }
}